<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="icon" href="media/sams-favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/visite.css">
    <link rel="stylesheet" href="css/navbar-anim.css">
        <title>Visite M√©dical - SAMS </title>
        <meta name="theme-color" content="#2f9e44">
        <!-- page CSS moved to css/index.css -->
    </head>

    <body class="animate-page">
        <nav class="site-navbar">
            <div class="container d-flex align-items-center justify-content-between">
                <div class="brand">
                    <div>
                        <div class="title">SAMS</div>
                        <div style="font-size:0.85rem;opacity:0.9">Visite M√©dicale</div>
                    </div>
                </div>
                <div class="d-flex align-items-center" style="gap:1rem">
                    <a href="index.html" class="text-white mr-3" title="R√®glement"><i class="fa fa-book nav-icon" aria-hidden="true"></i>R√®glement</a>
                    <a href="Visite_Medical.html" class="text-white mr-3" title="Visite M√©dicale"><i class="fa fa-stethoscope nav-icon" aria-hidden="true"></i>Visite</a>
                    <a href="deces.html" class="text-white mr-3" title="Certificats / D√©c√®s"><i class="fa fa-file-medical nav-icon" aria-hidden="true"></i>D√©c√®s</a>
                    <a href="psy.html" class="text-white mr-3" title="Psychologie"><i class="fa fa-brain nav-icon" aria-hidden="true"></i>Psychologie</a>
                    <button id="themeToggle" class="theme-toggle" aria-label="Basculer th√®me">üåô</button>
                </div>
            </div>
        </nav>
        <div class="page-wrapper">
            <section class="med-card visite-card">
                <!-- Header inside the card: logo + centered title (uses DA gradient) -->
                <div class="card-header-visite">
                    <div class="card-header-left">
                        <img src="./media/logo_pillbox.svg" alt="Logo PillBox" onerror="this.style.display='none'" class="visite-logo">
                    </div>
                    <div class="card-header-center">
                        <div class="visite-title">VISITE MEDICALE</div>
                    </div>
                    <div class="card-header-right" aria-hidden="true"></div>
                </div>
                <!-- Full-width top bar (section title) under logo and main title -->
                <div class="card-top-bar">
                    <div class="card-top-title">INFORMATIONS PERSONNELLES</div>
                </div>
                <form id="visiteForm" class="visite-form">

                    <!-- Top images row -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div id="photoArea" class="photo-placeholder" tabindex="0">
                                        <img id="photoPreview" alt="Photo patient">
                                        <button class="image-overlay-delete" data-target="photo" title="Supprimer">√ó</button>
                                    </div>
                                <div class="image-controls">
                                    <input id="photoInput" type="file" accept="image/*" style="display:none">
                                    <button type="button" class="btn btn-sm btn-outline-primary" data-target="photo">Charger</button>
                                    <button type="button" class="btn btn-sm image-delete-btn" data-target="photo">Supprimer</button>
                                </div>
                        </div>
                        <div class="col-md-4">
                            <div id="idArea" class="id-placeholder" tabindex="0">
                                <img id="idPreview" alt="Pi√®ce d'identit√©">
                                <button class="image-overlay-delete" data-target="id" title="Supprimer">√ó</button>
                            </div>
                            <div class="image-controls">
                                <input id="idInput" type="file" accept="image/*" style="display:none">
                                <button type="button" class="btn btn-sm btn-outline-primary" data-target="id">Charger</button>
                                <button type="button" class="btn btn-sm image-delete-btn" data-target="id">Supprimer</button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div id="workArea" class="workcard-placeholder" tabindex="0">
                                <img id="workPreview" alt="Carte professionnelle">
                                <button class="image-overlay-delete" data-target="work" title="Supprimer">√ó</button>
                            </div>
                            <div class="image-controls">
                                <input id="workInput" type="file" accept="image/*" style="display:none">
                                <button type="button" class="btn btn-sm btn-outline-primary" data-target="work">Charger</button>
                                <button type="button" class="btn btn-sm image-delete-btn" data-target="work">Supprimer</button>
                            </div>
                        </div>
                    </div>

                    <!-- Personal information -->
                    <div class="form-row">
                        <div class="col-sm-6 mb-2">
                            <label class="label">Nom</label>
                            <input type="text" name="nom" class="form-control visite-input" placeholder="Nom">
                        </div>
                        <div class="col-sm-6 mb-2">
                            <label class="label">Pr√©nom</label>
                            <input type="text" name="prenom" class="form-control visite-input" placeholder="Pr√©nom">
                        </div>
                        <div class="col-sm-4 mb-2">
                            <label class="label">Date de naissance</label>
                            <input type="date" name="dob" class="form-control visite-input small-input">
                        </div>
                        <div class="col-sm-4 mb-2">
                            <label class="label">N¬∞ de t√©l√©phone</label>
                            <input type="tel" name="phone" class="form-control visite-input" placeholder="06 00 00 00 00">
                        </div>
                        <div class="col-sm-4 mb-2">
                            <label class="label">ID / Matricule</label>
                            <input type="text" name="id" class="form-control visite-input" placeholder="ID">
                        </div>

                        <div class="col-12 mb-2">
                            <label class="label">Adresse</label>
                            <input type="text" name="address" class="form-control visite-input" placeholder="Adresse compl√®te">
                        </div>

                        <div class="col-12 mb-2">
                            <label class="label">Situation</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="situation" id="sit1" value="celibataire">
                                <label class="form-check-label" for="sit1">C√©libataire</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="situation" id="sit2" value="encouple">
                                <label class="form-check-label" for="sit2">En couple</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="situation" id="sit3" value="marie">
                                <label class="form-check-label" for="sit3">Mari√©(e)</label>
                            </div>
                        </div>

                        <div class="col-12 mb-2">
                            <label class="label">M√©tier</label>
                            <input type="text" name="job" class="form-control visite-input" placeholder="M√©tier">
                        </div>
                    </div>

                    <!-- Contact / Medical two-column -->
                    <div class="row visite-section">
                        <div class="col-md-6">
                            <div class="section-title">CONTACT D'URGENCE</div>
                            <div class="form-row mt-3">
                                <div class="col-6 mb-2">
                                    <label class="label">Nom</label>
                                    <input type="text" name="em_name" class="form-control visite-input">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">Pr√©nom</label>
                                    <input type="text" name="em_prenom" class="form-control visite-input">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">N¬∞ de t√©l√©phone</label>
                                    <input type="tel" name="em_phone" class="form-control visite-input">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">Adresse</label>
                                    <input type="text" name="em_address" class="form-control visite-input">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="section-title">INFORMATION M√âDICALE</div>
                            <div class="form-row mt-3">
                                <div class="col-4 mb-2">
                                    <label class="label">Taille (cm)</label>
                                    <input type="number" name="taille" class="form-control visite-input small-input">
                                </div>
                                <div class="col-4 mb-2">
                                    <label class="label">Poids (kg)</label>
                                    <input type="number" name="poids" class="form-control visite-input small-input">
                                </div>
                                <div class="col-4 mb-2">
                                    <label class="label">Groupe sanguin</label>
                                    <input type="text" name="groupe" class="form-control visite-input small-input" placeholder="A+, O-, etc.">
                                </div>

                                <div class="col-6 mb-2">
                                    <label class="label">Allergies</label>
                                    <input type="text" name="allergie" class="form-control visite-input">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">Traitement</label>
                                    <input type="text" name="traitement" class="form-control visite-input">
                                </div>

                                <div class="col-6 mb-2">
                                    <label class="label">Tabagisme</label>
                                    <input type="text" name="tabac" class="form-control visite-input" placeholder="Oui / Non / Quantit√©">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">Consommation alcool/drogue</label>
                                    <input type="text" name="alcool" class="form-control visite-input" placeholder="D√©tails">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vaccines -->
                    <div class="row visite-section">
                        <div class="col-12">
                            <div class="section-title">VACCINS</div>
                            <div class="vaccin-checkboxes mt-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="vac1" value="tetanos">
                                    <label class="form-check-label" for="vac1">T√©tanos</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="vac2" value="diphterie">
                                    <label class="form-check-label" for="vac2">Dipht√©rie</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="vac3" value="coqueluche">
                                    <label class="form-check-label" for="vac3">Coqueluche</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="vac4" value="polio">
                                    <label class="form-check-label" for="vac4">Poliomy√©lite</label>
                                </div>
                            </div>
                            <div class="form-row mt-3">
                                <div class="col-12">
                                    <label class="label">Notes</label>
                                    <textarea name="vaccin_notes" class="form-control visite-input" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tests and Psy -->
                    <div class="row visite-section">
                        <div class="col-md-6">
                            <div class="section-title">TESTS M√âDICAUX</div>
                            <div class="form-row mt-3">
                                <div class="col-6 mb-2">
                                    <label class="label">Tension art√©rielle</label>
                                    <input type="text" name="tension" class="form-control visite-input" placeholder="mmHg">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">Saturation en O2</label>
                                    <input type="text" name="saturation" class="form-control visite-input" placeholder="%">
                                </div>

                                <div class="col-12 mb-2">
                                    <label class="label">D√©pistage visuel</label>
                                    <input type="text" name="depistage" class="form-control visite-input" placeholder="Droite / Gauche">
                                </div>

                                <div class="col-12 mb-2">
                                    <label class="label">Test auditif</label>
                                    <input type="text" name="auditif" class="form-control visite-input" placeholder="Droite / Gauche">
                                </div>

                                <div class="col-6 mb-2">
                                    <label class="label">Fr√©quence cardiaque (avant)</label>
                                    <input type="text" name="fc_avant" class="form-control visite-input" placeholder="bpm">
                                </div>
                                <div class="col-6 mb-2">
                                    <label class="label">Fr√©quence cardiaque (apr√®s)</label>
                                    <input type="text" name="fc_apres" class="form-control visite-input" placeholder="bpm">
                                </div>

                                <div class="col-12 mb-2">
                                    <label class="label">Notes</label>
                                    <textarea name="tests_notes" class="form-control visite-input" rows="2"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="section-title">BILAN PSYCHOLOGIQUE</div>
                            <div class="psy-questions mt-3">
                                <label class="section-sub">1 - Avez-vous des ant√©c√©dents m√©dicaux ou chirurgicaux ?</label>
                                <textarea name="psy_q1" class="form-control visite-input" rows="2"></textarea>

                                <label class="section-sub mt-2">2 - Avez-vous des habitudes de sommeil r√©guli√®res ? Rencontrez-vous des probl√®mes de sommeil ?</label>
                                <textarea name="psy_q2" class="form-control visite-input" rows="2"></textarea>

                                <label class="section-sub mt-2">3 - Avez-vous √©t√© t√©moin d'√©v√©nements traumatisants ?</label>
                                <textarea name="psy_q3" class="form-control visite-input" rows="2"></textarea>

                                <label class="section-sub mt-2">4 - Comment g√©rez-vous le stress au quotidien ?</label>
                                <textarea name="psy_q4" class="form-control visite-input" rows="2"></textarea>

                                <label class="section-sub mt-2">5 - Compte rendu de la vie du patient</label>
                                <textarea name="psy_q5" class="form-control visite-input" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button id="previewBtn" type="button" class="btn btn-info"><i class="fa fa-eye"></i> Pr√©visualiser</button>
                        <button id="downloadPdf" type="button" class="btn btn-secondary"><i class="fa fa-download"></i> T√©l√©charger PDF</button>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>
                    </div>

                </form>
            </section>
        </div>

        <script src="js/theme.js"></script>
        <script src="js/navbar.js" defer></script>
        <script src="js/index.js"></script>
        <!-- html2pdf bundle (includes jsPDF wrapper) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
        <!-- explicit jsPDF (UMD) to ensure 'jsPDF' / 'jspdf' constructors are available for fallbacks -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script>
            // Some distributions expose jspdf under window.jspdf (UMD) with .jsPDF constructor.
            // html2pdf and older code expect window.jsPDF; normalize both names so code can use either.
            (function(){
                try{
                    if(window.jspdf && window.jspdf.jsPDF && !window.jsPDF){ window.jsPDF = window.jspdf.jsPDF; }
                    // in some builds jspdf exposes window.JSPDF ‚Äî normalize as well
                    if(!window.jsPDF && window.JSPDF){ window.jsPDF = window.JSPDF; }
                }catch(e){ console.warn('jsPDF normalization failed', e); }
            })();
        </script>
        <!-- ensure html2canvas is available (helps fallback and avoids ReferenceError) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script src="js/visite.js" defer></script>
    </body>
</html>